<?xml version="1.0" encoding="UTF-8"?>
<!-- Written by Eclipse BIRT 2.0 -->
<report xmlns="http://www.eclipse.org/birt/2005/design" version="3" id="1">
    <property name="createdBy">Eclipse BIRT Designer Version 2.0.1 Build &lt;20060222-1204></property>
    <property name="units">in</property>
    <list-property name="configVars">
        <structure>
            <property name="name">DatabaseUser</property>
            <property name="value">gratia</property>
        </structure>
        <structure>
            <property name="name">DatabasePassword</property>
            <property name="value">proto</property>
        </structure>
        <structure>
            <property name="name">YearMonth</property>
            <property name="value">2007-01</property>
        </structure>
    </list-property>
    <parameters>
        <parameter-group name="DatabaseAccess" id="84">
            <parameters>
                <scalar-parameter name="DatabaseURL" id="81">
                    <property name="hidden">true</property>
                    <property name="valueType">static</property>
                    <property name="dataType">string</property>
                    <property name="allowBlank">false</property>
                    <property name="format">Unformatted</property>
                    <property name="controlType">text-box</property>
                    <property name="defaultValue">jdbc:mysql://gratia-vm02.fnal.gov:3320/gratia_psacct</property>
                </scalar-parameter>
                <scalar-parameter name="DatabaseUser" id="83">
                    <property name="hidden">true</property>
                    <property name="valueType">static</property>
                    <property name="dataType">string</property>
                    <property name="allowBlank">false</property>
                    <property name="format">Unformatted</property>
                    <property name="controlType">text-box</property>
                    <property name="defaultValue">gratia</property>
                </scalar-parameter>
                <scalar-parameter name="DatabasePassword" id="82">
                    <property name="hidden">true</property>
                    <property name="valueType">static</property>
                    <property name="dataType">string</property>
                    <property name="allowBlank">false</property>
                    <property name="format">Unformatted</property>
                    <property name="controlType">text-box</property>
                    <property name="defaultValue">proto</property>
                </scalar-parameter>
            </parameters>
        </parameter-group>
        <scalar-parameter name="YearMonth" id="86">
            <property name="hidden">false</property>
            <text-property name="helpText">Only jobs that finished during this month will be included</text-property>
            <property name="valueType">static</property>
            <property name="dataType">string</property>
            <property name="promptText">yyyy-mm</property>
            <property name="allowBlank">false</property>
            <property name="format">Unformatted</property>
            <property name="controlType">text-box</property>
            <property name="defaultValue">2006-12</property>
        </scalar-parameter>
        <scalar-parameter name="SiteName" id="103">
            <property name="hidden">true</property>
            <property name="valueType">dynamic</property>
            <property name="dataType">string</property>
            <property name="promptText">Facility Name</property>
            <property name="allowBlank">false</property>
            <property name="format">Unformatted</property>
            <property name="controlType">list-box</property>
            <property name="dataSetName">SiteNames</property>
            <expression name="valueExpr">row["sitename"]</expression>
            <expression name="labelExpr">row["sitename"]</expression>
            <property name="mustMatch">false</property>
            <property name="fixedOrder">true</property>
            <property name="defaultValue">USCMS-FNAL-WC1-CE</property>
        </scalar-parameter>
        <scalar-parameter name="VOName" id="301">
            <property name="hidden">true</property>
            <property name="valueType">static</property>
            <property name="dataType">string</property>
            <property name="allowBlank">false</property>
            <property name="format">Unformatted</property>
            <property name="controlType">text-box</property>
            <property name="defaultValue">uscms</property>
        </scalar-parameter>
    </parameters>
    <data-sources>
        <oda-data-source extensionID="org.eclipse.birt.report.data.oda.jdbc" name="fermigrid1" id="4">
            <property name="odaDriverClass">com.mysql.jdbc.Driver</property>
            <property name="odaURL">jdbc:mysql://gratia-vm02.fnal.gov:3320/gratia_psacct</property>
            <property name="odaUser">gratia</property>
            <encrypted-property name="odaPassword">cHJvdG8=</encrypted-property>
        </oda-data-source>
    </data-sources>
    <data-sets>
        <oda-data-set extensionID="org.eclipse.birt.report.data.oda.jdbc.JdbcSelectDataSet" name="DateSummary" id="5">
            <property name="dataSource">fermigrid1</property>
            <list-property name="parameters">
                <structure>
                    <property name="name">YearMonth</property>
                    <property name="dataType">string</property>
                    <property name="position">1</property>
                    <expression name="defaultValue">'2006-09'</expression>
                    <property name="allowNull">true</property>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
                <structure>
                    <property name="name">SiteName</property>
                    <property name="dataType">string</property>
                    <property name="position">2</property>
                    <expression name="defaultValue">' '</expression>
                    <property name="isInput">true</property>
                </structure>
                <structure>
                    <property name="name">VOName</property>
                    <property name="dataType">string</property>
                    <property name="position">3</property>
                    <expression name="defaultValue">' '</expression>
                    <property name="isInput">true</property>
                    <property name="isOutput">false</property>
                </structure>
            </list-property>
            <property name="queryText">SELECT sum(J.CpuUserDuration+J.CpuSystemDuration)/(3600*1000) as cpuabs,  
date_format(J.EndTime, "%Y-%m") as yearmonth, 
J.VOName as voname,
J.LocalUserID as locuserid,
sum(J.CpuUserDuration+J.CpuSystemDuration) 
*C.BenchmarkScore/(3600*1000) as cpunorm
 FROM JobUsageRecord_Report J, CPUInfo C, CEProbes P, CETable CE
where J.Resource = 'Batch'
and J.HostDescription = C.HostDescription
and date_format(J.EndTime, "%Y-%m") = ?

and J.ProbeName = P.probename
and P.facility_id = CE.facility_id
and facility_name = ?

and J.VOName = ?
group by yearmonth, locuserid
order by yearmonth</property>
        </oda-data-set>
        <oda-data-set extensionID="org.eclipse.birt.report.data.oda.jdbc.JdbcSelectDataSet" name="SiteNames" id="106">
            <property name="dataSource">fermigrid1</property>
            <property name="queryText">select  facility_name as sitename from CETable C, CEProbes
where C.facility_id = CEProbes.facility_id
 and CEProbes.probename like "psacct%"</property>
        </oda-data-set>
    </data-sets>
    <styles>
        <style name="sans-style1" id="96">
            <property name="fontFamily">sans-serif</property>
        </style>
    </styles>
    <page-setup>
        <simple-master-page name="Simple MasterPage" id="2">
            <property name="type">us-letter</property>
            <page-footer>
                <text id="3">
                    <property name="style">sans-style1</property>
                    <property name="fontFamily">sans-serif</property>
                    <property name="fontSize">small</property>
                    <property name="contentType">html</property>
                    <text-property name="content"><![CDATA[<value-of>new Date()</value-of>]]></text-property>
                </text>
            </page-footer>
        </simple-master-page>
    </page-setup>
    <body>
        <text-data id="311">
            <property name="style">sans-style1</property>
            <property name="fontFamily">sans-serif</property>
            <property name="fontWeight">bold</property>
            <expression name="valueExpr">'Month:  ' +params["YearMonth"]</expression>
            <property name="contentType">html</property>
        </text-data>
        <text-data id="310">
            <property name="style">sans-style1</property>
            <property name="fontFamily">sans-serif</property>
            <property name="fontWeight">bold</property>
            <property name="borderBottomColor">#000000</property>
            <property name="borderBottomStyle">solid</property>
            <property name="borderBottomWidth">thin</property>
            <expression name="valueExpr">'Group: ' + params["VOName"]</expression>
            <property name="contentType">html</property>
        </text-data>
        <table id="255">
            <property name="style">sans-style1</property>
            <property name="fontFamily">sans-serif</property>
            <property name="width">100%</property>
            <property name="dataSet">DateSummary</property>
            <list-property name="paramBindings">
                <structure>
                    <property name="paramName">YearMonth</property>
                    <expression name="expression">params["YearMonth"]</expression>
                </structure>
                <structure>
                    <property name="paramName">VOName</property>
                    <expression name="expression">params["VOName"]</expression>
                </structure>
                <structure>
                    <property name="paramName">SiteName</property>
                    <expression name="expression">params["SiteName"]</expression>
                </structure>
            </list-property>
            <list-property name="sort">
                <structure>
                    <expression name="key">row["cpunorm"]</expression>
                    <property name="direction">desc</property>
                </structure>
                <structure>
                    <expression name="key">row["locuserid"]</expression>
                </structure>
            </list-property>
            <column id="292">
                <property name="width">12%</property>
                <property name="repeat">1</property>
            </column>
            <column id="288">
                <property name="width">10%</property>
                <property name="repeat">1</property>
            </column>
            <column id="305">
                <property name="width">10%</property>
            </column>
            <column id="335">
                <property name="width">50%</property>
            </column>
            <header>
                <row id="256">
                    <cell id="293">
                        <label id="298">
                            <property name="style">sans-style1</property>
                            <property name="fontFamily">sans-serif</property>
                            <property name="fontWeight">bold</property>
                            <property name="textUnderline">underline</property>
                            <text-property name="text">User</text-property>
                        </label>
                    </cell>
                    <cell id="265">
                        <label id="291">
                            <property name="style">sans-style1</property>
                            <property name="fontWeight">bold</property>
                            <property name="textUnderline">underline</property>
                            <property name="textAlign">right</property>
                            <text-property name="text">SpecINT2000-khours</text-property>
                        </label>
                    </cell>
                    <cell id="302">
                        <label id="307">
                            <property name="style">sans-style1</property>
                            <property name="fontWeight">bold</property>
                            <property name="textUnderline">underline</property>
                            <property name="textAlign">right</property>
                            <text-property name="text">% of Total</text-property>
                        </label>
                    </cell>
                    <cell id="332"/>
                </row>
            </header>
            <detail>
                <row id="267">
                    <cell id="295">
                        <data id="296">
                            <property name="style">sans-style1</property>
                            <property name="fontFamily">SansSerif</property>
                            <expression name="valueExpr">row["locuserid"]</expression>
                        </data>
                    </cell>
                    <cell id="276">
                        <data id="277">
                            <property name="style">sans-style1</property>
                            <property name="fontFamily">SansSerif</property>
                            <structure name="numberFormat">
                                <property name="category">Fixed</property>
                                <property name="pattern">#,##0.0</property>
                            </structure>
                            <property name="textAlign">right</property>
                            <expression name="valueExpr">row["cpunorm"]</expression>
                        </data>
                    </cell>
                    <cell id="303">
                        <data id="306">
                            <property name="style">sans-style1</property>
                            <property name="fontFamily">sans-serif</property>
                            <structure name="numberFormat">
                                <property name="category">Percent</property>
                                <property name="pattern">Percent</property>
                            </structure>
                            <property name="textAlign">right</property>
                            <expression name="valueExpr">row["cpunorm"] / Total.sum(row["cpunorm"])</expression>
                        </data>
                    </cell>
                    <cell id="333"/>
                </row>
            </detail>
            <footer>
                <row id="278">
                    <cell id="297"/>
                    <cell id="283">
                        <data id="309">
                            <property name="fontWeight">bold</property>
                            <property name="borderTopColor">#000000</property>
                            <property name="borderTopStyle">solid</property>
                            <property name="borderTopWidth">thin</property>
                            <structure name="numberFormat">
                                <property name="category">Fixed</property>
                                <property name="pattern">#,##0.0</property>
                            </structure>
                            <property name="textAlign">right</property>
                            <expression name="valueExpr">Total.sum(row["cpunorm"])</expression>
                        </data>
                    </cell>
                    <cell id="304"/>
                    <cell id="334"/>
                </row>
            </footer>
        </table>
    </body>
</report>
